!function(a){a.Jcrop=function(b,c){function d(a){return""+parseInt(a)+"px"}function e(a){return""+parseInt(a)+"%"}function f(a){return K.baseClass+"-"+a}function g(b){var c=a(b).offset();return[c.left,c.top]}function j(a){return[a.pageX-ea[0],a.pageY-ea[1]]}function k(a){a!=X&&(ha.setCursor(a),X=a)}function l(a,b){if(ea=g(M),ha.setCursor("move"==a?a:a+"-resize"),"move"==a)return ha.activateHandlers(n(b),s);var c=fa.getFixed(),d=o(a),e=fa.getCorner(o(d));fa.setPressed(fa.getCorner(d)),fa.setCurrent(e),ha.activateHandlers(m(a,c),s)}function m(a,b){return function(c){if(K.aspectRatio)switch(a){case"e":c[1]=b.y+1;break;case"w":c[1]=b.y+1;break;case"n":c[0]=b.x+1;break;case"s":c[0]=b.x+1}else switch(a){case"e":c[1]=b.y2;break;case"w":c[1]=b.y2;break;case"n":c[0]=b.x2;break;case"s":c[0]=b.x2}fa.setCurrent(c),ga.update()}}function n(a){var b=a;return ia.watchKeys(),function(a){fa.moveOffset([a[0]-b[0],a[1]-b[1]]),b=a,ga.update()}}function o(a){switch(a){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function p(a){return function(b){return K.disabled?!1:"move"!=a||K.allowMove?(W=!0,l(a,j(b)),b.stopPropagation(),b.preventDefault(),!1):!1}}function q(a,b,c){var d=a.width(),e=a.height();d>b&&b>0&&(d=b,e=b/a.width()*a.height()),e>c&&c>0&&(e=c,d=c/a.height()*a.width()),U=a.width()/d,V=a.height()/e,a.width(d).height(e)}function r(a){return{x:parseInt(a.x*U),y:parseInt(a.y*V),x2:parseInt(a.x2*U),y2:parseInt(a.y2*V),w:parseInt(a.w*U),h:parseInt(a.h*V)}}function s(a){var b=fa.getFixed();b.w>K.minSelect[0]&&b.h>K.minSelect[1]?(ga.enableHandles(),ga.done()):ga.release(),ha.setCursor(K.allowSelect?"crosshair":"default")}function t(a){if(K.disabled)return!1;if(!K.allowSelect)return!1;W=!0,ea=g(M),ga.disableHandles(),k("crosshair");var b=j(a);return fa.setPressed(b),ha.activateHandlers(u,s),ia.watchKeys(),ga.update(),a.stopPropagation(),a.preventDefault(),!1}function u(a){fa.setCurrent(a),ga.update()}function v(){var b=a("<div></div>").addClass(f("tracker"));return a.browser.msie&&b.css({opacity:0,backgroundColor:"white"}),b}function x(a){function b(){window.setTimeout(s,j)}var c=a[0]/U,d=a[1]/V,e=a[2]/U,f=a[3]/V;if(!Y){var g=fa.flipCoords(c,d,e,f),h=fa.getFixed(),i=initcr=[h.x,h.y,h.x2,h.y2],j=K.animationDelay,k=i[0],l=i[1],e=i[2],f=i[3],m=g[0]-initcr[0],n=g[1]-initcr[1],o=g[2]-initcr[2],p=g[3]-initcr[3],q=0,r=K.swingSpeed;ga.animMode(!0);var s=function(){return function(){q+=(100-q)/r,i[0]=k+q/100*m,i[1]=l+q/100*n,i[2]=e+q/100*o,i[3]=f+q/100*p,100>q?b():ga.done(),q>=99.8&&(q=100),z(i)}}();b()}}function y(a){z([a[0]/U,a[1]/V,a[2]/U,a[3]/V])}function z(a){fa.setPressed([a[0],a[1]]),fa.setCurrent([a[2],a[3]]),ga.update()}function A(b){"object"!=typeof b&&(b={}),K=a.extend(K,b),"function"!=typeof K.onChange&&(K.onChange=function(){}),"function"!=typeof K.onSelect&&(K.onSelect=function(){})}function B(){return r(fa.getFixed())}function C(){return fa.getFixed()}function D(a){A(a),I()}function E(){K.disabled=!0,ga.disableHandles(),ga.setCursor("default"),ha.setCursor("default")}function F(){K.disabled=!1,I()}function G(){ga.done(),ha.activateHandlers(null,null)}function H(){P.remove(),L.show()}function I(a){K.allowResize?a?ga.enableOnly():ga.enableHandles():ga.disableHandles(),ha.setCursor(K.allowSelect?"crosshair":"default"),ga.setCursor(K.allowMove?"move":"default"),P.css("backgroundColor",K.bgColor),"setSelect"in K&&(y(c.setSelect),ga.done(),delete K.setSelect),"trueSize"in K&&(U=K.trueSize[0]/N,V=K.trueSize[1]/O),Q=K.maxSize[0]||0,R=K.maxSize[1]||0,S=K.minSize[0]||0,T=K.minSize[1]||0,"outerImage"in K&&(M.attr("src",K.outerImage),delete K.outerImage),ga.refresh()}var b=b,c=c;"object"!=typeof b&&(b=a(b)[0]),"object"!=typeof c&&(c={}),"trackDocument"in c||(c.trackDocument=a.browser.msie?!1:!0,a.browser.msie&&"8"==a.browser.version.split(".")[0]&&(c.trackDocument=!0)),"keySupport"in c||(c.keySupport=a.browser.msie?!1:!0);var J={trackDocument:!1,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,borderOpacity:.4,handleOpacity:.5,handlePad:5,handleSize:9,handleOffset:5,edgeMargin:14,aspectRatio:0,keySupport:!0,cornerHandles:!0,sideHandles:!0,drawBorders:!0,dragEdges:!0,boxWidth:0,boxHeight:0,boundary:8,animationDelay:20,swingSpeed:3,allowSelect:!0,allowMove:!0,allowResize:!0,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){}},K=J;A(c);var L=a(b),M=L.clone().removeAttr("id").css({position:"absolute"});M.width(L.width()),M.height(L.height()),L.after(M).hide(),q(M,K.boxWidth,K.boxHeight);var N=M.width(),O=M.height(),P=a("<div />").width(N).height(O).addClass(f("holder")).css({position:"relative",backgroundColor:K.bgColor}).insertAfter(L).append(M);K.addClass&&P.addClass(K.addClass);var Q,R,S,T,U,V,W,X,Y,Z,$=a("<img />").attr("src",M.attr("src")).css("position","absolute").width(N).height(O),_=a("<div />").width(e(100)).height(e(100)).css({zIndex:310,position:"absolute",overflow:"hidden"}).append($),aa=a("<div />").width(e(100)).height(e(100)).css("zIndex",320),ba=a("<div />").css({position:"absolute",zIndex:300}).insertBefore(M).append(_,aa),ca=K.boundary,da=v().width(N+2*ca).height(O+2*ca).css({position:"absolute",top:d(-ca),left:d(-ca),zIndex:290}).mousedown(t),ea=g(M),fa=function(){function a(a){var a=g(a);p=n=a[0],q=o=a[1]}function b(a){var a=g(a);l=a[0]-p,m=a[1]-q,p=a[0],q=a[1]}function c(){return[l,m]}function d(a){var b=a[0],c=a[1];0>n+b&&(b-=b+n),0>o+c&&(c-=c+o),q+c>O&&(c+=O-(q+c)),p+b>N&&(b+=N-(p+b)),n+=b,p+=b,o+=c,q+=c}function e(a){var b=f();switch(a){case"ne":return[b.x2,b.y];case"nw":return[b.x,b.y];case"se":return[b.x2,b.y2];case"sw":return[b.x,b.y2]}}function f(){if(!K.aspectRatio)return j();var a,b,c=K.aspectRatio,d=K.minSize[0]/U,e=(K.minSize[1]/V,K.maxSize[0]/U),f=K.maxSize[1]/V,g=p-n,l=q-o,m=Math.abs(g),r=Math.abs(l),s=m/r;return 0==e&&(e=10*N),0==f&&(f=10*O),c>s?(b=q,w=r*c,a=0>g?n-w:w+n,0>a?(a=0,h=Math.abs((a-n)/c),b=0>l?o-h:h+o):a>N&&(a=N,h=Math.abs((a-n)/c),b=0>l?o-h:h+o)):(a=p,h=m/c,b=0>l?o-h:o+h,0>b?(b=0,w=Math.abs((b-o)*c),a=0>g?n-w:w+n):b>O&&(b=O,w=Math.abs(b-o)*c,a=0>g?n-w:w+n)),a>n?(d>a-n?a=n+d:a-n>e&&(a=n+e),b=b>o?o+(a-n)/c:o-(a-n)/c):n>a&&(d>n-a?a=n-d:n-a>e&&(a=n-e),b=b>o?o+(n-a)/c:o-(n-a)/c),0>a?(n-=a,a=0):a>N&&(n-=a-N,a=N),0>b?(o-=b,b=0):b>O&&(o-=b-O,b=O),last=k(i(n,o,a,b))}function g(a){return a[0]<0&&(a[0]=0),a[1]<0&&(a[1]=0),a[0]>N&&(a[0]=N),a[1]>O&&(a[1]=O),[a[0],a[1]]}function i(a,b,c,d){var e=a,f=c,g=b,h=d;return a>c&&(e=c,f=a),b>d&&(g=d,h=b),[Math.round(e),Math.round(g),Math.round(f),Math.round(h)]}function j(){var a=p-n,b=q-o;if(Q&&Math.abs(a)>Q&&(p=a>0?n+Q:n-Q),R&&Math.abs(b)>R&&(q=b>0?o+R:o-R),T&&Math.abs(b)<T&&(q=b>0?o+T:o-T),S&&Math.abs(a)<S&&(p=a>0?n+S:n-S),0>n&&(p-=n,n-=n),0>o&&(q-=o,o-=o),0>p&&(n-=p,p-=p),0>q&&(o-=q,q-=q),p>N){var c=p-N;n-=c,p-=c}if(q>O){var c=q-O;o-=c,q-=c}if(n>N){var c=n-O;q-=c,o-=c}if(o>O){var c=o-O;q-=c,o-=c}return k(i(n,o,p,q))}function k(a){return{x:a[0],y:a[1],x2:a[2],y2:a[3],w:a[2]-a[0],h:a[3]-a[1]}}var l,m,n=0,o=0,p=0,q=0;return{flipCoords:i,setPressed:a,setCurrent:b,getOffset:c,moveOffset:d,getCorner:e,getFixed:f}}(),ga=function(){function b(b){var c=a("<div />").css({position:"absolute",opacity:K.borderOpacity}).addClass(f(b));return _.append(c),c}function c(b,c){var d=a("<div />").mousedown(p(b)).css({cursor:b+"-resize",position:"absolute",zIndex:c});return aa.append(d),d}function g(a){return c(a,B++).css({top:d(-F+1),left:d(-F+1),opacity:K.handleOpacity}).addClass(f("handle"))}function h(a){var b=K.handleSize,f=F,g=b,h=b,i=f,j=f;switch(a){case"n":case"s":h=e(100);break;case"e":case"w":g=e(100)}return c(a,B++).width(h).height(g).css({top:d(-i+1),left:d(-j+1)})}function j(a){for(i in a)D[a[i]]=g(a[i])}function k(a){var b=Math.round(a.h/2-F),c=Math.round(a.w/2-F),e=(west=-F+1,a.w-F),f=a.h-F;"e"in D&&D.e.css({top:d(b),left:d(e)})&&D.w.css({top:d(b)})&&D.s.css({top:d(f),left:d(c)})&&D.n.css({left:d(c)}),"ne"in D&&D.ne.css({left:d(e)})&&D.se.css({top:d(f),left:d(e)})&&D.sw.css({top:d(f)}),"b"in D&&D.b.css({top:d(f)})&&D.r.css({left:d(e)})}function l(a,b){$.css({top:d(-b),left:d(-a)}),ba.css({top:d(b),left:d(a)})}function m(a,b){ba.width(a).height(b)}function n(){var a=fa.getFixed();fa.setPressed([a.x,a.y]),fa.setCurrent([a.x2,a.y2]),o()}function o(){return A?q():void 0}function q(){var a=fa.getFixed();m(a.w,a.h),l(a.x,a.y),K.drawBorders&&C.right.css({left:d(a.w-1)})&&C.bottom.css({top:d(a.h-1)}),E&&k(a),A||s(),K.onChange(r(a))}function s(){ba.show(),M.css("opacity",K.bgOpacity),A=!0}function t(){x(),ba.hide(),M.css("opacity",1),A=!1}function u(){E&&(k(fa.getFixed()),aa.show())}function w(){return E=!0,K.allowResize?(k(fa.getFixed()),aa.show(),!0):void 0}function x(){E=!1,aa.hide()}function y(a){(Y=a)?x():w()}function z(){y(!1),n()}var A,B=370,C={},D={},E=!1,F=K.handleOffset;K.drawBorders&&(C={top:b("hline").css("top",d(a.browser.msie?-1:0)),bottom:b("hline"),left:b("vline"),right:b("vline")}),K.dragEdges&&(D.t=h("n"),D.b=h("s"),D.r=h("e"),D.l=h("w")),K.sideHandles&&j(["n","s","e","w"]),K.cornerHandles&&j(["sw","nw","ne","se"]);var G=v().mousedown(p("move")).css({cursor:"move",position:"absolute",zIndex:360});return _.append(G),x(),{updateVisible:o,update:q,release:t,refresh:n,setCursor:function(a){G.css("cursor",a)},enableHandles:w,enableOnly:function(){E=!0},showHandles:u,disableHandles:x,animMode:y,done:z}}(),ha=function(){function b(){da.css({zIndex:450}),k&&a(document).mousemove(d).mouseup(e)}function c(){da.css({zIndex:290}),k&&a(document).unbind("mousemove",d).unbind("mouseup",e)}function d(a){h(j(a))}function e(a){return a.preventDefault(),a.stopPropagation(),W&&(W=!1,i(j(a)),K.onSelect(r(fa.getFixed())),c(),h=function(){},i=function(){}),!1}function f(a,c){return W=!0,h=a,i=c,b(),!1}function g(a){da.css("cursor",a)}var h=function(){},i=function(){},k=K.trackDocument;return k||da.mousemove(d).mouseup(e).mouseout(e),M.before(da),{activateHandlers:f,setCursor:g}}(),ia=function(){function b(){K.keySupport&&(f.show(),f.focus())}function c(a){f.hide()}function d(a,b,c){K.allowMove&&(fa.moveOffset([b,c]),ga.updateVisible()),a.preventDefault(),a.stopPropagation()}function e(a){if(a.ctrlKey)return!0;Z=a.shiftKey?!0:!1;var b=Z?10:1;switch(a.keyCode){case 37:d(a,-b,0);break;case 39:d(a,b,0);break;case 38:d(a,0,-b);break;case 40:d(a,0,b);break;case 27:ga.release();break;case 9:return!0}return nothing(a)}var f=a('<input type="radio" />').css({position:"absolute",left:"-30px"}).keypress(e).blur(c),g=a("<div />").css({position:"absolute",overflow:"hidden"}).append(f);return K.keySupport&&g.insertBefore(M),{watchKeys:b}}();aa.hide(),I(!0);var ja={animateTo:x,setSelect:y,setOptions:D,tellSelect:B,tellScaled:C,disable:E,enable:F,cancel:G,focus:ia.watchKeys,getBounds:function(){return[N*U,O*V]},getWidgetSize:function(){return[N,O]},release:ga.release,destroy:H};return L.data("Jcrop",ja),ja},a.fn.Jcrop=function(b){function c(c){var d=b.useImg||c.src,e=new Image;e.onload=function(){a.Jcrop(c,b)},e.src=d}return"object"!=typeof b&&(b={}),this.each(function(){if(a(this).data("Jcrop")){if("api"==b)return a(this).data("Jcrop");a(this).data("Jcrop").setOptions(b)}else c(this)}),this}}(jQuery);